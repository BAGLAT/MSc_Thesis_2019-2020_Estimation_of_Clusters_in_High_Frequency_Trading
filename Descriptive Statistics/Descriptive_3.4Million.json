{"paragraphs":[{"title":"PySpark Library","text":"%pyspark\r\nimport pyspark\r\nfrom pyspark.sql.functions import lit\r\nfrom pyspark.sql.functions import lag, col\r\nfrom pyspark.sql.window import Window\r\nfrom pyspark.sql.types import (StructField,FloatType,TimestampType,StructType)\r\nfrom pyspark.sql import functions as f\r\nfrom pyspark.sql.functions import format_number","dateUpdated":"2020-09-09T20:26:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false},"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599682404258_-1024783345","id":"20200813-221302_537357574","dateCreated":"2020-09-09T20:13:24+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1245"},{"title":"Job Start Time","text":"%pyspark\nimport time\nstart_time = time.time()","dateUpdated":"2020-09-09T20:26:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false},"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599682404263_-1026707090","id":"20200813-221309_1101965174","dateCreated":"2020-09-09T20:13:24+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1246"},{"title":"Import Data","text":"%pyspark\ndf = spark.read.csv(\"s3://aws-logs-664959780319-us-east-1/data/34lkh.csv\",header=True)\ndf.printSchema()\ndf.show(10)","dateUpdated":"2020-09-09T20:41:53+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false},"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- datetime: string (nullable = true)\n |-- close: string (nullable = true)\n\n+-------------------+------+\n|           datetime| close|\n+-------------------+------+\n|2010-01-03 18:02:00|938.75|\n|2010-01-03 18:03:00|939.25|\n|2010-01-03 18:04:00|938.75|\n|2010-01-03 18:05:00| 939.0|\n|2010-01-03 18:06:00|938.75|\n|2010-01-03 18:07:00| 939.0|\n|2010-01-03 18:08:00| 939.5|\n|2010-01-03 18:09:00|939.25|\n|2010-01-03 18:10:00|939.25|\n|2010-01-03 18:11:00| 939.0|\n+-------------------+------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1599682404264_-1028630834","id":"20200813-221320_6388054","dateCreated":"2020-09-09T20:13:24+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1247"},{"title":"Compute Log Returns","text":"%pyspark\r\ndf3 = df\r\ndf3 = df3.withColumn(\"Id\", lit('1'))\r\nw = Window().partitionBy().orderBy(col(\"Id\"))\r\ndf3 = df3.select(\"*\", lag(\"close\").over(w).alias(\"close_shift\"))\r\ndf3 = df3.withColumn('returns', pyspark.sql.functions.log(col('close') / col('close_shift'))*100)\r\ndf3.show()\r\n#df3 = df3.select(df3['date'],df3['minute'],df3['close'],format_number(df3['returns'].cast('float'),6).alias('returns'))","dateUpdated":"2020-09-09T20:27:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false},"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------+------+---+-----------+--------------------+\n|           datetime| close| Id|close_shift|             returns|\n+-------------------+------+---+-----------+--------------------+\n|2010-01-03 18:02:00|938.75|  1|       null|                null|\n|2010-01-03 18:03:00|939.25|  1|     938.75| 0.05324813757337702|\n|2010-01-03 18:04:00|938.75|  1|     939.25|-0.05324813757337432|\n|2010-01-03 18:05:00| 939.0|  1|     938.75| 0.02662761299185153|\n|2010-01-03 18:06:00|938.75|  1|      939.0|-0.02662761299183...|\n|2010-01-03 18:07:00| 939.0|  1|     938.75| 0.02662761299185153|\n|2010-01-03 18:08:00| 939.5|  1|      939.0| 0.05323396452570121|\n|2010-01-03 18:09:00|939.25|  1|      939.5|-0.02661343994416...|\n|2010-01-03 18:10:00|939.25|  1|     939.25|                 0.0|\n|2010-01-03 18:11:00| 939.0|  1|     939.25|-0.02662052458154079|\n|2010-01-03 18:12:00| 939.5|  1|      939.0| 0.05323396452570121|\n|2010-01-03 18:13:00| 939.5|  1|      939.5|                 0.0|\n|2010-01-03 18:14:00| 939.5|  1|      939.5|                 0.0|\n|2010-01-03 18:15:00|939.75|  1|      939.5|0.026606359076742962|\n|2010-01-03 18:16:00|939.75|  1|     939.75|                 0.0|\n|2010-01-03 18:17:00|939.75|  1|     939.75|                 0.0|\n|2010-01-03 18:18:00| 940.0|  1|     939.75| 0.02659928197621348|\n|2010-01-03 18:19:00| 940.0|  1|      940.0|                 0.0|\n|2010-01-03 18:20:00| 940.0|  1|      940.0|                 0.0|\n|2010-01-03 18:21:00|940.25|  1|      940.0|0.026592208639614374|\n+-------------------+------+---+-----------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1599682404264_-1028630834","id":"20200813-221332_1724522654","dateCreated":"2020-09-09T20:13:24+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1248"},{"title":"Descriptive Statistics","text":"%pyspark\nresult = df3.describe()\nresult.select(result['summary'],format_number(result['returns'].cast('float'),6).alias('returns'),).show()\ndf3.agg(f.skewness(df3.returns)).show()\ndf3.agg(f.kurtosis(df3.returns)).show()","dateUpdated":"2020-09-09T20:27:16+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false},"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+----------------+\n|summary|         returns|\n+-------+----------------+\n|  count|1,048,575.000000|\n|   mean|        0.000034|\n| stddev|        0.039295|\n|    min|       -3.062325|\n|    max|        1.957217|\n+-------+----------------+\n\n+-------------------+\n|  skewness(returns)|\n+-------------------+\n|-0.2908258298743752|\n+-------------------+\n\n+-----------------+\n|kurtosis(returns)|\n+-----------------+\n|99.00874823436382|\n+-----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1599682404264_-1028630834","id":"20200813-221344_1389007478","dateCreated":"2020-09-09T20:13:24+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1249"},{"title":"Job End - Decision Latency","text":"%pyspark\nprint(\"--- %s seconds ---\" % (time.time() - start_time))","dateUpdated":"2020-09-09T20:27:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false},"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--- 32.19134259223938 seconds ---\n"}]},"apps":[],"jobName":"paragraph_1599682404265_-1029015583","id":"20200813-221352_874083652","dateCreated":"2020-09-09T20:13:24+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1250"},{"text":"%pyspark\n","dateUpdated":"2020-09-09T20:13:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599682404265_-1029015583","id":"20200813-221456_768381913","dateCreated":"2020-09-09T20:13:24+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1251"}],"name":"Descriptive_3.4Million","id":"2FHJY6954","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}