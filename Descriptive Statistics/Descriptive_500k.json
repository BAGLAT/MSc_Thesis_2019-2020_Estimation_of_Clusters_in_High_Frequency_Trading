{"paragraphs":[{"title":"PySpark Library","text":"%pyspark\r\nimport pyspark\r\nfrom pyspark.sql.functions import lit\r\nfrom pyspark.sql.functions import lag, col\r\nfrom pyspark.sql.window import Window\r\nfrom pyspark.sql.types import (StructField,FloatType,TimestampType,StructType)\r\nfrom pyspark.sql import functions as f\r\nfrom pyspark.sql.functions import format_number","dateUpdated":"2020-09-09T20:33:55+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599683635803_-1165394006","id":"20200813-221302_537357574","dateCreated":"2020-09-09T20:33:55+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:961"},{"title":"Job Start Time","text":"%pyspark\nimport time\nstart_time = time.time()","dateUpdated":"2020-09-09T20:33:55+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599683635804_-1167317751","id":"20200813-221309_1101965174","dateCreated":"2020-09-09T20:33:55+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:962"},{"title":"Import Data","text":"%pyspark\ndf = spark.read.csv(\"s3://aws-logs-664959780319-us-east-1/data/5lkh.csv\",header=True)\ndf.printSchema()\ndf.show(10)","dateUpdated":"2020-09-09T20:38:45+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- datetime: string (nullable = true)\n |-- close: string (nullable = true)\n\n+-------------------+-------+\n|           datetime|  close|\n+-------------------+-------+\n|2019-01-01 18:02:00|2501.25|\n|2019-01-01 18:03:00| 2504.5|\n|2019-01-01 18:04:00| 2508.5|\n|2019-01-01 18:05:00|2507.25|\n|2019-01-01 18:06:00| 2507.5|\n|2019-01-01 18:07:00| 2507.0|\n|2019-01-01 18:08:00|2506.25|\n|2019-01-01 18:09:00| 2506.5|\n|2019-01-01 18:10:00|2508.25|\n|2019-01-01 18:11:00| 2507.5|\n+-------------------+-------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1599683635804_-1167317751","id":"20200813-221320_6388054","dateCreated":"2020-09-09T20:33:55+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:963"},{"title":"Compute Log Returns","text":"%pyspark\r\ndf3 = df\r\ndf3 = df3.withColumn(\"Id\", lit('1'))\r\nw = Window().partitionBy().orderBy(col(\"Id\"))\r\ndf3 = df3.select(\"*\", lag(\"close\").over(w).alias(\"close_shift\"))\r\ndf3 = df3.withColumn('returns', pyspark.sql.functions.log(col('close') / col('close_shift'))*100)\r\ndf3.show()\r\n#df3 = df3.select(df3['date'],df3['minute'],df3['close'],format_number(df3['returns'].cast('float'),6).alias('returns'))","dateUpdated":"2020-09-09T20:33:55+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------+-------+---+-----------+--------------------+\n|           datetime|  close| Id|close_shift|             returns|\n+-------------------+-------+---+-----------+--------------------+\n|2019-01-01 18:02:00|2501.25|  1|       null|                null|\n|2019-01-01 18:03:00| 2504.5|  1|    2501.25|  0.1298506899728267|\n|2019-01-01 18:04:00| 2508.5|  1|     2504.5| 0.15958511266361844|\n|2019-01-01 18:05:00|2507.25|  1|     2508.5|-0.04984299559899333|\n|2019-01-01 18:06:00| 2507.5|  1|    2507.25|0.009970586777284032|\n|2019-01-01 18:07:00| 2507.0|  1|     2507.5|-0.01994216777972...|\n|2019-01-01 18:08:00|2506.25|  1|     2507.0|-0.02992071034140...|\n|2019-01-01 18:09:00| 2506.5|  1|    2506.25|0.009974564867885723|\n|2019-01-01 18:10:00|2508.25|  1|     2506.5| 0.06979411021640594|\n|2019-01-01 18:11:00| 2507.5|  1|    2508.25|-0.02990579696315574|\n|2019-01-01 18:12:00|2506.75|  1|     2507.5|-0.02991474320558...|\n|2019-01-01 18:13:00| 2506.5|  1|    2506.75|-0.00997357004765...|\n|2019-01-01 18:14:00|2506.25|  1|     2506.5|-0.00997456486788...|\n|2019-01-01 18:15:00| 2508.5|  1|    2506.25| 0.08973528694283858|\n|2019-01-01 18:16:00|2509.25|  1|     2508.5|0.029893876960205967|\n|2019-01-01 18:17:00|2509.25|  1|    2509.25|                 0.0|\n|2019-01-01 18:18:00|2508.75|  1|    2509.25|-0.01992825833617577|\n|2019-01-01 18:19:00|2509.25|  1|    2508.75|0.019928258336171168|\n|2019-01-01 18:20:00| 2508.5|  1|    2509.25|-0.02989387696020296|\n|2019-01-01 18:21:00|2508.75|  1|     2508.5|0.009965618624024489|\n+-------------------+-------+---+-----------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1599683635804_-1167317751","id":"20200813-221332_1724522654","dateCreated":"2020-09-09T20:33:55+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:964"},{"title":"Descriptive Statistics","text":"%pyspark\nresult = df3.describe()\nresult.select(result['summary'],format_number(result['returns'].cast('float'),6).alias('returns'),).show()\ndf3.agg(f.skewness(df3.returns)).show()\ndf3.agg(f.kurtosis(df3.returns)).show()","dateUpdated":"2020-09-09T20:33:55+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------------+\n|summary|      returns|\n+-------+-------------+\n|  count|65,535.000000|\n|   mean|     0.000140|\n| stddev|     0.024733|\n|    min|    -0.383181|\n|    max|     0.381207|\n+-------+-------------+\n\n+--------------------+\n|   skewness(returns)|\n+--------------------+\n|0.012084075918943697|\n+--------------------+\n\n+------------------+\n| kurtosis(returns)|\n+------------------+\n|15.253381918337158|\n+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1599683635804_-1167317751","id":"20200813-221344_1389007478","dateCreated":"2020-09-09T20:33:55+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:965"},{"title":"Job End - Decision Latency","text":"%pyspark\nprint(\"--- %s seconds ---\" % (time.time() - start_time))","dateUpdated":"2020-09-09T20:33:55+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--- 4.907745599746704 seconds ---\n"}]},"apps":[],"jobName":"paragraph_1599683635804_-1167317751","id":"20200813-221352_874083652","dateCreated":"2020-09-09T20:33:55+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:966"},{"text":"%pyspark\n","dateUpdated":"2020-09-09T20:33:55+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599683635804_-1167317751","id":"20200813-221456_768381913","dateCreated":"2020-09-09T20:33:55+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:967"}],"name":"Descriptive_500k","id":"2FHEX3499","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}